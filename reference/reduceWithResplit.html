<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Merge regions, re-splitting large merges using local overlap minima — reduceWithResplit • epiwraps</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Merge regions, re-splitting large merges using local overlap minima — reduceWithResplit"><meta name="description" content='This is an alternative to something like
reduce(unlist(GRangesList(peaks))) for merging overlapping regions"
it tries to break up large merged regions based on the profile of overlap
with the un-merged regions. We typically use this to merge for instance peaks
called on different samples.'><meta property="og:description" content='This is an alternative to something like
reduce(unlist(GRangesList(peaks))) for merging overlapping regions"
it tries to break up large merged regions based on the profile of overlap
with the un-merged regions. We typically use this to merge for instance peaks
called on different samples.'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">epiwraps</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.98</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/bam2bw.html">Generating bigwig tracks with bam2bw</a></li>
    <li><a class="dropdown-item" href="../articles/misc.html">Miscellaneous epiwraps functions</a></li>
    <li><a class="dropdown-item" href="../articles/multiRegionPlot.html">Visualizing signals across many regions</a></li>
    <li><a class="dropdown-item" href="../articles/normalization.html">Normalizing genomic signals</a></li>
    <li><a class="dropdown-item" href="../articles/singleRegionPlot.html">Visualizing signals in a single region</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Merge regions, re-splitting large merges using local overlap minima</h1>

      <div class="d-none name"><code>reduceWithResplit.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This is an alternative to something like
<code>reduce(unlist(GRangesList(peaks)))</code> for merging overlapping regions"
it tries to break up large merged regions based on the profile of overlap
with the un-merged regions. We typically use this to merge for instance peaks
called on different samples.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">reduceWithResplit</span><span class="op">(</span></span>
<span>  <span class="va">peaks</span>,</span>
<span>  softMaxSize <span class="op">=</span> <span class="fl">500L</span>,</span>
<span>  relTroughDepth <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,</span>
<span>  minTroughDepth <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>  minTroughWidth <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  minDistFromBoundary <span class="op">=</span> <span class="fl">150L</span>,</span>
<span>  minPeakSize <span class="op">=</span> <span class="fl">100L</span>,</span>
<span>  BPPARAM <span class="op">=</span> <span class="fu">BiocParallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">SerialParam</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-peaks">peaks<a class="anchor" aria-label="anchor" href="#arg-peaks"></a></dt>
<dd><p>A list of <code><a href="https://rdrr.io/pkg/GenomicRanges/man/GRanges-class.html" class="external-link">GRanges-class</a></code>, or a
<code><a href="https://rdrr.io/pkg/GenomicRanges/man/GRanges-class.html" class="external-link">GRanges-class</a></code> containing overlapping regions.</p></dd>


<dt id="arg-softmaxsize">softMaxSize<a class="anchor" aria-label="anchor" href="#arg-softmaxsize"></a></dt>
<dd><p>The (merged) peak size below which re-splitting will be
attempted</p></dd>


<dt id="arg-reltroughdepth">relTroughDepth<a class="anchor" aria-label="anchor" href="#arg-reltroughdepth"></a></dt>
<dd><p>The minimum depth of local minima, as a fraction of the
maximum. E.g. with a maxima of 12 peaks, the default of 1/4 would require
the minima to be below or equal to 9.</p></dd>


<dt id="arg-mintroughdepth">minTroughDepth<a class="anchor" aria-label="anchor" href="#arg-mintroughdepth"></a></dt>
<dd><p>The absolute minimum depth of local minima, in number
of peaks below the maxima.</p></dd>


<dt id="arg-mintroughwidth">minTroughWidth<a class="anchor" aria-label="anchor" href="#arg-mintroughwidth"></a></dt>
<dd><p>The minimum width of the local minima.</p></dd>


<dt id="arg-mindistfromboundary">minDistFromBoundary<a class="anchor" aria-label="anchor" href="#arg-mindistfromboundary"></a></dt>
<dd><p>The minimum distance of the local minima from the
peak border.</p></dd>


<dt id="arg-minpeaksize">minPeakSize<a class="anchor" aria-label="anchor" href="#arg-minpeaksize"></a></dt>
<dd><p>The minimum final peak size.</p></dd>


<dt id="arg-bpparam">BPPARAM<a class="anchor" aria-label="anchor" href="#arg-bpparam"></a></dt>
<dd><p>BiocParallel Param object for multithreading. If set,
chromosomes are split into threads.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A reduced `GRanges` of non-overlapping peaks.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This is an alternative to something like
<code>reduce(unlist(GRangesList(peaks)))</code>, which stitches overlapping regions
together and can result in large regions that can be problematic for some
applications. The function tries to break those large regions into composing
by using the coverage by the original (un-merged) regions. See the example
below for an illustration.
The procedure first reduces `peaks`, then identifies reduced regions whose
width is above a certain threshold (`softMaxSize`). For those regions, a
coverage by the original peaks is computed to identify local minima
('troughs') in the coverage that could divide the region into sub-regions of
desirable lengths. `relThroughDepth` determines the minimum depth of the
trough (i.e. decrease) as a fraction of the maximum coverage in the region,
while `minTroughDepth` determines the absolute minimum depth.
Note that the algorithm iterates through regions one by one and as such is
quite slow, hence multithreading is recommended for large sets of regions.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># consider the following example set of regions:</span></span></span>
<span class="r-in"><span><span class="va">gr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GenomicRanges/man/GRanges-class.html" class="external-link">GRanges</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/IRanges-constructor.html" class="external-link">IRanges</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">120</span>,<span class="fl">140</span>,<span class="fl">390</span>,<span class="fl">410</span>,<span class="fl">430</span>,<span class="fl">120</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           width<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>,<span class="fl">520</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plotSignalTracks.html">plotSignalTracks</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>regions<span class="op">=</span><span class="va">gr</span>, <span class="st">"# overlapping regions"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/coverage-methods.html" class="external-link">coverage</a></span><span class="op">(</span><span class="va">gr</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      reduced<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/inter-range-methods.html" class="external-link">reduce</a></span><span class="op">(</span><span class="va">gr</span><span class="op">)</span><span class="op">)</span>, region<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/inter-range-methods.html" class="external-link">reduce</a></span><span class="op">(</span><span class="va">gr</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="reduceWithResplit-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># if we are interested in having smaller regions, clearly it would seem </span></span></span>
<span class="r-in"><span><span class="co"># sensible here to cut roughly in the middle, since we have two distinct </span></span></span>
<span class="r-in"><span><span class="co"># groups of regions that are only joined by a single region</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">redGr</span> <span class="op">&lt;-</span> <span class="fu">reduceWithResplit</span><span class="op">(</span><span class="va">gr</span>, softMaxSize<span class="op">=</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GRanges object with 2 ranges and 0 metadata columns:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       seqnames    ranges strand</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [1]        1   100-363      *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [2]        1   365-639      *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   seqinfo: 1 sequence from an unspecified genome; no seqlengths</span>
<span class="r-in"><span><span class="fu"><a href="plotSignalTracks.html">plotSignalTracks</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"# overlapping regions"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/coverage-methods.html" class="external-link">coverage</a></span><span class="op">(</span><span class="va">gr</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      reduced<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/inter-range-methods.html" class="external-link">reduce</a></span><span class="op">(</span><span class="va">gr</span><span class="op">)</span>, <span class="st">"reduced\n\\w resplit"</span><span class="op">=</span><span class="va">redGr</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      region<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/inter-range-methods.html" class="external-link">reduce</a></span><span class="op">(</span><span class="va">gr</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="reduceWithResplit-2.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pierre-Luc Germain, Emanuel Sonder.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

